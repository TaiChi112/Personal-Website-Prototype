# Memento Pattern - Version Control System

```mermaid
classDiagram
    class IMemento {
        <<interface>>
        +getVersion() string
        +getDate() Date
        +getMetadata() string
    }
    
    class ContentMemento {
        -version: string
        -timestamp: Date
        +title: string
        +detail: string
        +constructor(version, timestamp, title, detail)
        +getVersion() string
        +getDate() Date
        +getMetadata() string
    }
    
    class Content {
        -title: string
        -detail: string
        -version: string
        -lastModified: Date
        +constructor(title, detail, version)
        +edit(title, detail, newVersion, simulatedTime) void
        +save() IMemento
        +restore(memento IMemento) void
        +show() void
    }
    
    class VersionControl {
        -history: Map~string, IMemento~
        -originator: Content
        +constructor(originator Content)
        +commit() void
        +checkout(version string) void
        +showHistory() void
    }
    
    IMemento <|.. ContentMemento : implements
    Content --> IMemento : creates/returns
    Content ..> IMemento : restores from
    VersionControl o--> IMemento : stores
    VersionControl --> Content : uses
```

## Memento Component
- **Memento Interface**: `IMemento`
- **Concrete Memento**: `ContentMemento`
- **Originator**: `Content`
- **Caretaker**: `VersionControl`

## Part of code is crucial

```ts
public save(): IMemento {
        return new ContentMemento(
            this.version,
            this.lastModified, // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            this.title,
            this.detail
        );
    }
```
```ts
 public restore(memento: IMemento): void {
        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Memento ‡∏Ç‡∏≠‡∏á Content ‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏´‡∏°
        if (!(memento instanceof ContentMemento)) {
            console.error("‚ùå Error: Invalid memento type.");
            return;
        }

        this.title = memento.title;
        this.detail = memento.detail;
        this.version = memento.getVersion();
        this.lastModified = memento.getDate();

        console.log(`‚è™ Restored to: [${this.version}] (Modified: ${this.lastModified.toLocaleTimeString()})`);
    }
```
```ts
// method edit: ‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ simulatedTime ‡πÑ‡∏î‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Demo ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô
    public edit(title: string, detail: string, newVersion: string, simulatedTime?: Date): void {
        this.title = title;
        this.detail = detail;
        this.version = newVersion;

        // üî• Update ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô Edit ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        this.lastModified = simulatedTime || new Date();

        console.log(`üìù Edited Content: [${this.version}] "${this.title}"`);
    }
```

```ts
public commit(): void {
        const snapshot = this.originator.save();

        this.history.set(snapshot.getVersion(), snapshot);

        console.log(`üíæ Committed: [${snapshot.getVersion()}]`);
    }

    public checkout(version: string): void {
        const snapshot = this.history.get(version);
        if (!snapshot) {
            console.error(`‚ùå Checkout Failed: Version "${version}" not found.`);
            return;
        }
        this.originator.restore(snapshot);
    }
```

## ‡πÉ‡∏ä‡πâ Caretaker ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ history ‡∏Ç‡∏≠‡∏á Memento ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å Originator


## üéØ Key Concepts

### **Memento Pattern Benefits:**
1. **Encapsulation** - Internal state ‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Memento ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢ implementation
2. **Undo/Redo** - ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á state ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏î‡πâ
3. **Separation of Concerns** - Caretaker ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô Originator
4. **Type Safety** - ‡πÉ‡∏ä‡πâ interface ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡πà‡∏≠‡∏ô concrete implementation

### **Critical Points:**
- ‚úÖ **Memento** ‡∏´‡πâ‡∏≤‡∏° Caretaker ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (readonly, private)
- ‚úÖ **Originator** ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á state ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô Memento ‡πÑ‡∏î‡πâ
- ‚úÖ **Caretaker** ‡πÄ‡∏Å‡πá‡∏ö Memento ‡πÄ‡∏õ‡πá‡∏ô collection (Map, Array) ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- ‚úÖ **Interface Segregation** - Caretaker ‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏Ñ‡πà narrow interface (IMemento)

## Planning in the Future
- ‡πÄ‡∏û‡∏¥‡πà‡∏° feature **Branch** ‡πÅ‡∏•‡∏∞ **Merge** (Git-like workflow)
- ‡πÄ‡∏û‡∏¥‡πà‡∏° **Compression** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Memento ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πà‡∏≤‡∏°‡∏≤‡∏Å
- ‡πÄ‡∏û‡∏¥‡πà‡∏° **Diff Viewer** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á versions
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö **Concurrent Editing** (Operational Transformation)

### 1Ô∏è‚É£ **MEMENTO - Encapsulate State**
```typescript
// Memento Interface (Wide Interface for Originator)
interface IMemento {
    getVersion(): string;
    getDate(): Date;
    getMetadata(): string;
}

// Concrete Memento - Encapsulates Originator's internal state
class ContentMemento implements IMemento {
    constructor(
        private version: string,
        private timestamp: Date,
        public readonly title: string,   // Originator's state
        public readonly detail: string   // Originator's state
    ) { }
    
    getVersion(): string { return this.version; }
    getDate(): Date { return this.timestamp; }
    getMetadata(): string { return `${this.title}`; }
}
```

### 2Ô∏è‚É£ **ORIGINATOR - Create & Restore Snapshot**
```typescript
class Content {
    private title: string;
    private detail: string;
    private version: string;
    private lastModified: Date;

    // Create Memento (Snapshot) - returns narrow interface
    public save(): IMemento {
        return new ContentMemento(
            this.version,
            this.lastModified,
            this.title,
            this.detail
        );
    }

    // Restore from Memento
    public restore(memento: IMemento): void {
        if (!(memento instanceof ContentMemento)) {
            console.error("‚ùå Invalid memento type.");
            return;
        }
        
        this.title = memento.title;
        this.detail = memento.detail;
        this.version = memento.getVersion();
        this.lastModified = memento.getDate();
    }
}
```

### 3Ô∏è‚É£ **CARETAKER - Manage History**
```typescript
class VersionControl {
    private history: Map<string, IMemento> = new Map();
    private originator: Content;

    // Save current state
    public commit(): void {
        const snapshot = this.originator.save();
        this.history.set(snapshot.getVersion(), snapshot);
    }

    // Restore to specific version
    public checkout(version: string): void {
        const snapshot = this.history.get(version);
        if (!snapshot) {
            console.error(`‚ùå Version "${version}" not found.`);
            return;
        }
        this.originator.restore(snapshot);
    }
}

// Usage - Version Control System
const article = new Content("Design Patterns", "Intro...", "v1.0");
const git = new VersionControl(article);

git.commit();                                          // Save v1.0
article.edit("Updated Title", "New content", "v2.0");  // Edit
git.commit();                                          // Save v2.0
git.checkout("v1.0");                                  // Restore to v1.0
```

![Alt text](../refactor/diagram/asset/memento.png "Memento Pattern")
