```mermaid
classDiagram
    %% ==========================================
    %% FLYWEIGHT PATTERN (Tag System)
    %% ==========================================
    namespace Flyweight {
        class ContentTag {
            +name: string
            +color: string
            +format(content: string) string
            %% +decorateContent(title: string, extra?: string) string
        }
        
        class TagFactory {
            -cache: Map~string, ContentTag~
            +getTag(type) ContentTag
            +getCacheSize() number
        }
    }

    %% ==========================================
    %% ADAPTER PATTERN (Content System)
    %% ==========================================
    namespace Adapter_Target {
        class IContent {
            <<Interface>>
            +render() void
            +getTitle() string
            +getTagInfo() string
        }
    }

    namespace Adapter_Adaptees {
        class LegacyArticle {
            +title: string
            +author: string
            +content: string
        }
        
        class LegacyProject {
            +name: string
            +repoUrl: string
            +lang: string
        }
    }

    namespace Adapter_Adapters {
        class ArticleAdapter {
            -adaptee: LegacyArticle
            -tag: ContentTag
            +render() void
            +getTitle() string
            +getTagInfo() string
        }
        
        class ProjectAdapter {
            -adaptee: LegacyProject
            -tag: ContentTag
            +render() void
            +getTitle() string
            +getTagInfo() string
        }
    }

    %% ==========================================
    %% RELATIONSHIPS
    %% ==========================================
    
    %% Flyweight Pattern
    TagFactory ..> ContentTag : creates/caches
    
    %% Adapter Pattern - Implementation
    IContent <|.. ArticleAdapter
    IContent <|.. ProjectAdapter
    
    %% Adapter Pattern - Wrapping
    ArticleAdapter --> LegacyArticle : wraps
    ProjectAdapter --> LegacyProject : wraps
    
    %% Integration: Adapters use Flyweight
    ArticleAdapter ..> TagFactory : gets tag from
    ProjectAdapter ..> TagFactory : gets tag from
    ArticleAdapter --> ContentTag : holds reference
    ProjectAdapter --> ContentTag : holds reference
```

## Part of Code is Crucial

**Flyweight - ContentTag methods for Adapter usage:**
```ts
public format(content: string): string {
    return `[${this.color}] ${this.name}: ${content}`;
}

// public decorateContent(title: string, extra?: string): string {
//     const base = `[${this.color}] ${this.name}: ${title}`;
//     return extra ? `${base} (${extra})` : base;
// }
```

**Adapter - Using Flyweight's format method:**
```ts
public render(): void {
    console.log(this.tag.format(`${this.adaptee.title} (by ${this.adaptee.author})`));
}
```

**Factory - Cache Management:**
```ts
public getTag(type: 'article' | 'project'): ContentTag {
    if (!this.cache.has(type)) {
        const color = type === 'article' ? 'Green' : 'Blue';
        const newTag = new ContentTag(type, color);
        this.cache.set(type, newTag);
    }
    return this.cache.get(type)!;
}
```

## Flyweight + Adapter Component
- **Flyweight**: `ContentTag`
- **Flyweight Factory**: `TagFactory`
- **Adapter Target**: `IContent`
- **Adapter Adaptees**: `LegacyArticle`, `LegacyProject`
- **Adapter Adapters**: `ArticleAdapter`, `ProjectAdapter`
- **Client**: `User`

![Alt text](../refactor/diagram/asset/flyweight.png "Flyweight + Adapter Pattern")

